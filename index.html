<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Massage barrel â€“ Roulette (SVG + NSFW)</title>

<link rel="manifest" href="./manifest.webmanifest">
<link rel="apple-touch-icon" href="./icons/apple-touch-icon.png">
<meta name="theme-color" content="#0f1220" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  :root{
    --rose:#ff5ca8; --bleu:#3fa7ff; --ink:#0b0b0f; --text:#eef2ff; --muted:#9aa3b2;
    --bg:#0b0f1a; --ring: rgba(255,255,255,.12);
    --glow1:#1e2746; --glow2:#242a4a;
    --accent:#ffd166;
    --segA:#ff5ca8; --segB:#3fa7ff; /* SFW alternance */
    --nsfwA:#ff2740; --nsfwB:#0e0c10; /* NSFW alternance (rouge / rouge-noir) */
  }
  /* ThÃ¨me NSFW (rouge/noir intense) */
  .nsfw-on{
    --bg:#0a0a0d;
    --glow1:#3b0d14;
    --glow2:#0f0a0e;
    --accent:#ff2740;
  }

  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{
    margin:0; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Inter,Roboto,Arial,sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 80% -10%, var(--glow1) 0%, rgba(30,39,70,0) 60%),
      radial-gradient(900px 600px at 0% 100%, var(--glow2) 0%, rgba(36,42,74,0) 55%),
      var(--bg);
    padding: env(safe-area-inset-top) env(safe-area-inset-right) calc(env(safe-area-inset-bottom) + 8px) env(safe-area-inset-left);
    transition: background 400ms ease;
  }
  .wrap{width:min(980px,100%);margin:0 auto;padding:12px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid var(--ring);border-radius:18px;padding:clamp(12px,2.8vw,18px);box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{
    margin:0 0 8px; font-weight:900; letter-spacing:.2px; line-height:1.15;
    font-size:clamp(22px,4.8vw,32px);
    background: linear-gradient(90deg, var(--bleu), var(--rose));
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .nsfw-on h1{ animation: pulse 2.6s ease-in-out infinite; }
  @keyframes pulse{ 0%,100%{filter:drop-shadow(0 0 0 rgba(255,39,64,.0))} 50%{filter:drop-shadow(0 0 18px rgba(255,39,64,.32))} }

  .muted{color:var(--muted);font-size:clamp(13px,3.2vw,15px)}
  .wheel-box{display:grid;place-items:center}
  .pointer{
    width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;border-bottom:26px solid var(--accent);
    margin:2px 0 -8px; filter:drop-shadow(0 6px 10px rgba(0,0,0,.35));
  }
  svg{width:min(86vw,560px);height:auto;display:block;filter:drop-shadow(0 12px 24px rgba(0,0,0,.4));touch-action:manipulation}
  .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  button{
    appearance:none;border:1px solid var(--ring);background:#12162a;color:var(--text);
    border-radius:14px;padding:12px 16px;font-weight:700;font-size:clamp(14px,3.8vw,16px);min-width:120px;cursor:pointer
  }
  .primary{background:linear-gradient(135deg, var(--bleu), var(--rose)); color:var(--ink); border:none}
  .nsfw-on .primary{ background:linear-gradient(135deg, #ff2740, #b80f2d); color:#0b0b0f; }

  .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid var(--ring);font-size:clamp(12px,3.2vw,14px)}
  .swatch{width:14px;height:14px;border-radius:50%}
  .result{margin-top:10px;padding:12px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid var(--ring);font-size:clamp(14px,3.6vw,16px);display:none}
  .legend{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:6px}
  /* Switch iOS NSFW */
  .switch{display:flex;align-items:center;gap:10px;justify-content:center;margin:6px 0 2px}
  .switch .lab{font-weight:700; letter-spacing:.2px}
  .toggle{
    --w:56px; --h:30px; --r:14px;
    position:relative; width:var(--w); height:var(--h); border-radius:var(--h);
    background: #2a2f45; border:1px solid var(--ring); cursor:pointer; transition: background .2s ease, border-color .2s ease;
  }
  .toggle::after{
    content:""; position:absolute; top:2px; left:2px; width:26px; height:26px; border-radius:50%;
    background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.4); transition: transform .22s ease;
  }
  .toggle.on{ background:#ff2740; border-color:#ff2740; }
  .toggle.on::after{ transform: translateX(26px); }

  @media (prefers-reduced-motion:reduce){svg{transition:none}}
</style>
</head>
<body>
  <div class="wrap">
    <section class="card" style="text-align:center">
      <h1>Massage barrel</h1>

      <!-- Switch NSFW -->
      <div class="switch">
        <span class="lab muted">NSFW</span>
        <div id="nsfwToggle" class="toggle" role="switch" aria-checked="false" tabindex="0"></div>
      </div>

      <div class="wheel-box">
        <div class="pointer" aria-hidden="true"></div>

        <!-- SVG WHEEL -->
        <svg id="wheelSvg" viewBox="-500 -500 1000 1000" aria-label="Roue de massage">
          <defs id="defs"></defs>
          <g id="wheelGroup"></g>

          <!-- hub -->
          <circle r="140" fill="#fff"></circle>
          <text x="0" y="-6" fill="#11131e" font-weight="800" font-size="64" text-anchor="middle" font-family="-apple-system,Inter,Roboto">Massage</text>
          <text x="0" y="46" fill="#11131e" font-weight="800" font-size="40" text-anchor="middle" font-family="-apple-system,Inter,Roboto">barrel</text>
        </svg>

        <div class="controls">
          <button id="spin" class="primary">ðŸŽ¡ Lancer</button>
          <button id="reset">â†º RÃ©initialiser</button>
        </div>

        <!-- LÃ©gende : SFW = bleu/rose, NSFW = rouge/rouge-noir -->
        <div id="legend" class="legend">
          <span class="chip"><span class="swatch" style="background:var(--bleu)"></span> Bleu&nbsp;: <b>Baptistou</b></span>
          <span class="chip"><span class="swatch" style="background:var(--rose)"></span> Rose&nbsp;: <b>Julitou</b></span>
        </div>

        <div id="out" class="result"></div>
      </div>
    </section>
  </div>

<script>
(function(){
  const NAME_BLUE = "Baptistou";
  const NAME_ROSE = "Julitou";

  // SFW : liste fixe (non Ã©ditable)
  const LIST_SFW = [
    "Ã‰paules","Nuque","Dos","Bras","Mains","Pieds","Jambes","Visage","TÃªte","Mollets","Cuisses"
  ];

  // NSFW : liste fournie (le suffixe (H)/(F) indique pour qui câ€™est)
  const LIST_NSFW_RAW = [
    "Happy Ending",
    "Lingam(H)",
    "Cuni(F)",
    "Levrette",
    "Yoni(H)",
    "Missionnaire",
    "Anus(H)"
  ];

  // PWA SW
  if ('serviceWorker' in navigator) window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));

  const svg  = document.getElementById('wheelSvg');
  const defs = document.getElementById('defs');
  const group= document.getElementById('wheelGroup');
  const legend = document.getElementById('legend');
  const out = document.getElementById('out');
  const nsfwToggle = document.getElementById('nsfwToggle');

  let nsfw=false, invert=false, spinning=false, angle=0;
  let items=[]; // objets {label, tag: 'H'|'F'|null}

  function css(v){return getComputedStyle(document.documentElement).getPropertyValue(v).trim();}

  // Parse NSFW tags
  function parseNSFW(list){
    return list.map(s=>{
      const m = s.match(/\((H|F)\)\s*$/i);
      const tag = m ? m[1].toUpperCase() : null;
      const label = m ? s.replace(/\((H|F)\)\s*$/i,'').trim() : s.trim();
      return {label, tag}; // tag=null => both
    });
  }

  function loadItems(){
    if (!nsfw){
      items = LIST_SFW.map(label => ({label, tag:null}));
    } else {
      items = parseNSFW(LIST_NSFW_RAW);
    }
  }

  // Color per index depending on mode
  function colorAt(i){
    if (!nsfw){
      // alternance rose/bleu (SFW)
      return (i%2===0) ? css('--segB') : css('--segA'); // bleu / rose
    } else {
      // alternance rouge / rouge-noir (NSFW)
      return (i%2===0) ? css('--nsfwA') : css('--nsfwB');
    }
  }

  // Build SVG wheel
  function buildWheel(){
    loadItems();
    group.innerHTML=''; defs.innerHTML='';

    const n = items.length; const R=480; const Rt=300; const sep='rgba(255,255,255,.2)';

    for(let i=0;i<n;i++){
      const a0=-Math.PI/2+i*(2*Math.PI/n), a1=-Math.PI/2+(i+1)*(2*Math.PI/n);
      group.appendChild( el('path',{d:sectorPath(0,0,R,a0,a1), fill:colorAt(i)}) );
      group.appendChild( el('line',{x1:0,y1:0,x2:R*Math.cos(a0),y2:R*Math.sin(a0),stroke:sep,'stroke-width':2}) );

      const arcId=`arc-${i}`; defs.appendChild( el('path',{id:arcId,d:arcPath(0,0,Rt,a0+0.08,a1-0.08),fill:'none'}) );
      const txt=el('text',{'font-family':'-apple-system, Inter, Roboto, Arial','fill':'#0b0b0f','font-weight':'700'});
      const tp =el('textPath',{href:`#${arcId}`,'startOffset':'50%','text-anchor':'middle'}, sanitize(items[i].label));
      txt.appendChild(tp); group.appendChild(txt);
      fitTextOnPath(txt,tp,defs.lastChild,22,10);
    }
    const aEnd=-Math.PI/2+n*(2*Math.PI/n);
    group.appendChild( el('line',{x1:0,y1:0,x2:R*Math.cos(aEnd),y2:R*Math.sin(aEnd),stroke:sep,'stroke-width':2}) );

    // LÃ©gende
    if (!nsfw){
      legend.innerHTML = `
        <span class="chip"><span class="swatch" style="background:var(--bleu)"></span> Bleu&nbsp;: <b>${NAME_BLUE}</b></span>
        <span class="chip"><span class="swatch" style="background:var(--rose)"></span> Rose&nbsp;: <b>${NAME_ROSE}</b></span>
      `;
    } else {
      legend.innerHTML = `
        <span class="chip"><span class="swatch" style="background:var(--nsfwA)"></span> Rouge</span>
        <span class="chip"><span class="swatch" style="background:var(--nsfwB)"></span> Rouge&nbsp;foncÃ©</span>
        <span class="chip">Receveur&nbsp;: (H)=<b>${NAME_BLUE}</b>, (F)=<b>${NAME_ROSE}</b>, sinon alÃ©atoire</span>
      `;
    }
  }

  // Helpers SVG
  function el(name, attrs={}, text){ const e=document.createElementNS('http://www.w3.org/2000/svg', name); for(const k in attrs) e.setAttribute(k, attrs[k]); if(text!=null) e.textContent=text; return e; }
  function sectorPath(cx,cy,r,a0,a1){ const x0=cx+r*Math.cos(a0),y0=cy+r*Math.sin(a0), x1=cx+r*Math.cos(a1),y1=cy+r*Math.sin(a1); const large=(a1-a0)%(2*Math.PI)>Math.PI?1:0; return `M ${cx} ${cy} L ${x0} ${y0} A ${r} ${r} 0 ${large} 1 ${x1} ${y1} Z`; }
  function arcPath(cx,cy,r,a0,a1){ const x0=cx+r*Math.cos(a0),y0=cy+r*Math.sin(a0), x1=cx+r*Math.cos(a1),y1=cy+r*Math.sin(a1); const large=(a1-a0)%(2*Math.PI)>Math.PI?1:0; return `M ${x0} ${y0} A ${r} ${r} 0 ${large} 1 ${x1} ${y1}`; }
  function arcLength(pathEl){ try{ return pathEl.getTotalLength(); } catch{ return 0; } }
  function sanitize(s){ return s.replace(/[\u0000-\u001F<>]/g,'').trim(); }
  function fitTextOnPath(textEl, textPathEl, arcEl, maxFs, minFs){
    const avail = arcLength(arcEl) * 0.9;
    let fs = maxFs; textEl.setAttribute('font-size', fs);
    const getLen = ()=> textEl.getComputedTextLength ? textEl.getComputedTextLength() : (textEl.textContent.length*fs*0.6);
    while(getLen()>avail && fs>minFs){ fs--; textEl.setAttribute('font-size', fs); }
    if (getLen()>avail){
      let s = textPathEl.textContent;
      while(s.length>2 && getLen()>avail){ s = s.slice(0,-1); textPathEl.textContent = s + 'â€¦'; }
    }
  }

  // Spin
  function setAngle(deg){ angle=deg; svg.style.transform=`rotate(${deg}deg)`; svg.style.transformOrigin='50% 50%'; }
  function showResultSFW(isBlue, part){
    out.style.display='block';
    out.innerHTML = `<b>${isBlue ? NAME_BLUE : NAME_ROSE}</b> masse <b>${escapeHtml(part)}</b> â€” `
      + `<span class="chip"><span class="swatch" style="background:${isBlue?'var(--bleu)':'var(--rose)'}"></span>${isBlue?'Bleu':'Rose'}</span>`;
  }
  function showResultNSFW(item){
    // Receveur selon tag
    let receiver = null;
    if (item.tag === 'H') receiver = NAME_BLUE;
    else if (item.tag === 'F') receiver = NAME_ROSE;
    else receiver = Math.random() < 0.5 ? NAME_BLUE : NAME_ROSE;

    out.style.display='block';
    out.innerHTML = `ðŸŽ² <b>${escapeHtml(item.label)}</b> â€” Pour&nbsp;<b>${receiver}</b>`;
  }
  function hideResult(){ out.style.display='none'; }

  function spin(){
    if(spinning) return; spinning=true; hideResult();
    const n=items.length, seg=360/n, idx=Math.floor(Math.random()*n), center=idx*seg+seg/2;
    const turns=5+Math.floor(Math.random()*3), final=turns*360+(360-center), jitter=(Math.random()-0.5)*6;

    svg.style.transition='transform 5.2s cubic-bezier(.12,.65,.06,1)'; void svg.offsetWidth; setAngle(final+jitter);
    const end=()=>{
      svg.removeEventListener('transitionend',end);
      svg.style.transition='transform .001s linear'; setAngle(final);
      setTimeout(()=> svg.style.transition='transform 5.2s cubic-bezier(.12,.65,.06,1)', 10);

      if (!nsfw){
        // SFW : couleur -> qui masse
        const col = colorAt(idx);
        const isBlue = col.toLowerCase() === css('--segB').toLowerCase();
        showResultSFW(isBlue, items[idx].label);
      } else {
        // NSFW : tag -> receveur
        showResultNSFW(items[idx]);
      }

      if (navigator.vibrate) navigator.vibrate(10);
      spinning=false;
    };
    svg.addEventListener('transitionend', end);
  }

  // NSFW toggle (thÃ¨me + contenu)
  function setNSFW(on){
    nsfw = !!on;
    document.body.classList.toggle('nsfw-on', nsfw);
    nsfwToggle.classList.toggle('on', nsfw);
    nsfwToggle.setAttribute('aria-checked', nsfw ? 'true' : 'false');
    buildWheel();
    setAngle(0);
    hideResult();
  }

  // Events
  document.getElementById('spin').addEventListener('click', spin);
  document.getElementById('reset').addEventListener('click', ()=>{ setAngle(0); hideResult(); });
  nsfwToggle.addEventListener('click', ()=> setNSFW(!nsfw));
  nsfwToggle.addEventListener('keydown', (e)=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); setNSFW(!nsfw); } });

  function escapeHtml(s){return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

  // Init
  setNSFW(false); // dÃ©marre en mode Safe
})();
</script>
</body>
</html>
